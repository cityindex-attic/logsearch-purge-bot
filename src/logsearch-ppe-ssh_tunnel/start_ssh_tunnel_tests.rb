#!/usr/bin/env ruby

def sh_with_cf_env(cmd)
	environment = { "VCAP_SERVICES" => "{\"user-provided\":[{\"name\":\"logsearch-ppe-ssh_tunnel\",\"label\":\"user-provided\",\"tags\":[],\"credentials\":{\"uri\":\"ubuntu@redis.logsearch.cityindextest5.co.uk\",\"ssh_private_key_base64\":\"LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQ0KTUlJRXBRSUJBQUtDQVFFQTFWR2RRVm1jOEdrV1JlNEUzYmhTVHpuVkdwT1Q0WDRVTWxWVys4NitpRHpYZnFpdA0KdzYxaDRyYWUzWUNmOWw2ZVBpa054dmFJUDFxbFU5TVFhaDZQZ2ZTWmRrYWxTcnlBSnJ2YzZlQi9mUlJpcVVJNw0KQWNhTGNCcjBmYTBVTVJwZ3BrMW4zNklFU2xYRkxibndwZWpJUWRBaUtuaTdicmNkWEtHNHlIM25kK0FMSGRoNg0Ka2hBQzg5QW04VjEvZEUrOFVmcjFObHUzOUVHbTAvbUhQQXFNbWZJUjBudXMwSkpUcTlnTTBXYkFkMW5ZSlc1Mw0KRGJzMzVkT21UMk5mdTJMM04xNEVCNWRCb05VanV1NzZnRDZUY3ZlRlJrUWdERlRtaFE0VGlUWmVsY0E0U3E0dw0KZUdEOEZEWmRTaC9haUlrWHJnNWdzOHRWTm4xY1JsMHo2aE5oSndJREFRQUJBb0lCQVFDM0lzSW5BSkJEdFhSeA0KeE01WXE0MitocC8xbVEwMFlkRmxCTzhRYjRZVDRHZ0JUVDhnNXhGS1dnNDVpOXZJMzZKckswT3d0S1p6L1paQw0KU01tbTBXWFM0L044SDFwNHR5d3VGTXFyM3hpVWdaUFNUQkhzakUvWmhzcXZ1by9ET0NvUm5CSzVZNWJiV3BkVg0Ka25TUGV6R3hqc1pHUURCcDlMczRjMzc0WVY3L0FiNjZQaHhTL1g1M0xKcklBZjhCYmNWZnpaZUkwRDN1ZjFpbQ0KU085YSs1MURIa3QyeTcvTWJHOUJaUStpcWRZOTd3Ykx3bElBeFBpcWxkQmN2Vy83QStYdGE1clRPeEdsWGxCNQ0KenE2SU1Zbjg3YkpKN1g0bnlNYlQ2NjZSajJmbXRYT1MrNUtDR1VzTHpWNWd1NWNYclE1NVovSmhGaDNWWUU3eQ0KbEJGMVBtTUJBb0dCQVA4M21hRGJRNFNtYzNNTjVBOXFwcHNmNVNIUlRKVit1L1BJQ3dLN2gzc1dWSzRJVS84ag0KWUVlbkJlZnNxaGJTNkt0bC82cTVMTTRWZnN5YmwxRVVVZjB5Zkd0NElSVGVGVWg3cnhlcWFsNzJkb2U2cm00cQ0KVlNWSlU4VXgxMHgrdEgweG50aG91bS8yOTYzTVlqNUI3UFIyQWd2UUJxaFFjenZyWTVidjBGKzNBb0dCQU5YNQ0KSFhFaDRQclhWd1B5ZkZxbnk5TDd3MklXMzVEVVB6dXp6TzVvWFlvQTJiWDFFdS9aeEJwTUpSZzZSUlhKaThMMQ0KQzIvVEE1UHVMNnc2TWYzZXh0eS9ZeEdxL1U0akxEcUJQd3dlSjdKQk5jRnFHUSs3NUszK0tnckx0dVdVNUY5TA0KcU5wK0NMRzZmWUJ2VVQrN2l5OEUvSVJRWWhLNnUzSlozb3k4dnlvUkFvR0JBSTF4WWdvOUdxbE1tcFU4TUpXKw0KdE1FcUp4SGI3a2EzNnpDTFFGYnVXWUtFK0w5T3pFYU5jNUdpWm1xSHhpaEtFVHJVbDZJbGFFaDZyMEIwUnFOZg0KMEtTenN6TFlhL1VsczhQdEVEZmNjWUZadEkwNmordHNPSzRtZW0vQ1ZLRUhZNzR5bnVjdSs0eUw0ZTZIWkRjKw0KMERVWHBjQ29OTmhaWmRQaWU5b3Q1RnozQW9HQVl0bEc1TERHQXB2Z3N3NGVyTEsvMHFSRVN0aE9SOVlGc0VzTA0KN1VlQmp2TjlvRFdybmVwNFViM0RsVUcyRUs2ZlJsMTEveDc0bENxQkU0dCs5TTBxQ1dqUkY2UnFpT0p1MkVoRg0KSEJBQ1ByTXBaa1RoZHdkU1NaOFZSUTkvV3VoQjZGUkhtVWlJTTdMM3I1RzljemZzd0xnSkFBY3loM3lFZy90SQ0KZUxQcGpFRUNnWUVBb1ZMRTg5SkxPdi9ZVWRBRmVQQWU4cDJDWis1YU9tRmRBc0RqOFk1NDA1YjkzbWM0aHMweQ0KQWJQUHkxeWtmRWt4ZFRZUEJEeHU0cmZoWDVYZjdERE1PTzJFZ2ZuZzI5Ujc1QWtoSDNlY0gweDV6ejlpMkNlNw0KZFc5YkVlRGh4MURFMThlR2hsYjNvL1Fsd0dEeS9OYVBuZWxsU1NneDdTa2cvT0I4Z1ZwaStuVT0NCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0t\",\"ssh_known_hosts_base64\":\"cmVkaXMubG9nc2VhcmNoLmNpdHlpbmRleHRlc3Q1LmNvLnVrIHNzaC1yc2EgQUFBQUIzTnphQzF5YzJFQUFBQURBUUFCQUFBQkFRRFZ0SVViaWp0Rm1TL3ZGOHVPd1k0VDMzbzFidS9qcEthUmw3dmprb0Nrdi9PZ0xwVUljOUNCV0VidEoxUXpCK2Y0Z0gwdEdsVG54cjA4TU1jbkd5VDZZaUhSa2FEMDJidC9wTm9BVEZxLzdDVkQxMENKaDc5a0tRZlFtUllyRTE2RXJsTU9idkp4K1lxSFRLMk1MSlJRZU0rTTBYeTloNTNGWlFUZUp6SnJCUllvcmROMUJxUDVWVW16YTl2bGFkNlBpNFEwbVRxUmMyK1dKVmJJRndDT1hhN21NbHNBdEh0UEZ2czhhLzhjNEQ5ZEdSNHhqN3dvaWlXSGx0NGNJc2cwZW5kRWg1SnVCSjNyQTdvS2Y3dEQ0TUFISlRJMDFWY2kvbmxCWnRDYTV3VnNKb29va1hUVEJCcVpHcG9JYkJXa1o5Titwa0FOOFArM3dGaWppRkJqDQo1NC4yMTYuMTkxLjEwNCBzc2gtcnNhIEFBQUFCM056YUMxeWMyRUFBQUFEQVFBQkFBQUJBUURWdElVYmlqdEZtUy92Rjh1T3dZNFQzM28xYnUvanBLYVJsN3Zqa29Da3YvT2dMcFVJYzlDQldFYnRKMVF6QitmNGdIMHRHbFRueHIwOE1NY25HeVQ2WWlIUmthRDAyYnQvcE5vQVRGcS83Q1ZEMTBDSmg3OWtLUWZRbVJZckUxNkVybE1PYnZKeCtZcUhUSzJNTEpSUWVNK00wWHk5aDUzRlpRVGVKekpyQlJZb3JkTjFCcVA1VlVtemE5dmxhZDZQaTRRMG1UcVJjMitXSlZiSUZ3Q09YYTdtTWxzQXRIdFBGdnM4YS84YzREOWRHUjR4ajd3b2lpV0hsdDRjSXNnMGVuZEVoNUp1QkozckE3b0tmN3RENE1BSEpUSTAxVmNpL25sQlp0Q2E1d1ZzSm9vb2tYVFRCQnFaR3BvSWJCV2taOU4rcGtBTjhQKzN3RmlqaUZCag0KbG9nc2VhcmNoLmNpdHlpbmRleHRlc3Q1LmNvLnVrLDU0LjIyOC4xNS4yNTIgc3NoLXJzYSBBQUFBQjNOemFDMXljMkVBQUFBREFRQUJBQUFCQVFERVd1UzJjMUNkQU1Lc1RCQjh5Z0h2QTRxb2liRnQ2NGRubVhQOE1pU3BjL2R4RkZ1UnJmVFFWOG9mbEJhZDhWRnNnbEdPNlA4L2NFdUZZUTZPc0NPTjFnK2N3YlFjYkM4cTFDWVlyckVqc1NhVkhJZTZONXBRTVlWYXdieWVxVmVFZUtudXV0WDg5bFl3UWt0WEtQUEJ2WjBrZDRKZ0t0WGpKWS9ZVit2YjRLL3o3U1htV0o4V2hob0ROLytDRW0zRGFIWWNDaW8wNFMzUEoxL0xnUUV3Z014VDh4ak94bG9KUkFscVFVNnZpR29yNk9ieFVwS0hGRUlmNDlKMjlVUHJrRXd0b0VmQTBFUUZnYSttdTJ5ZUZxbGlIRmpaRFh6MERlamQzTFE0Nnh4dmhxcXpmS0U4b1dzWU5sNkVpdHkreE1SNlUwemVCeWR2TDVHZ1U3RXg=\"}}]}" }
	system(environment, cmd)
end

sh_with_cf_env('./start_ssh_tunnel.rb "-L 127.0.0.1:9200:elasticsearch.srv-int.logsearch.cityindextest5.co.uk:9200"')